{% extends "base_publica.html" %}

{% block titulo %}Anúncios{% endblock %}

{% block content %}
<div class="container py-4">
    <!-- Cabeçalho -->
    <div class="row mb-4">
        <div class="col-12">
            <h1><i class="bi bi-shop"></i> Anúncios</h1>
            <p class="text-muted">Encontre os melhores produtos dos nossos vendedores</p>
        </div>
    </div>

    <!-- Filtros -->
    <div class="card shadow-sm mb-4">
        <div class="card-body">
            <form action="/anuncios" method="get" class="row g-3">
                <div class="col-md-6">
                    <label for="busca" class="form-label">Buscar</label>
                    <div class="input-group">
                        <span class="input-group-text"><i class="bi bi-search"></i></span>
                        <input type="text" class="form-control" id="busca" name="busca"
                               placeholder="Digite o nome do produto..." value="{{ busca }}">
                    </div>
                </div>
                <div class="col-md-4">
                    <label for="categoria" class="form-label">Categoria</label>
                    <select class="form-select" id="categoria" name="categoria">
                        <option value="">Todas as categorias</option>
                        {% for cat in categorias %}
                        <option value="{{ cat.id }}" {% if categoria_selecionada == cat.id %}selected{% endif %}>
                            {{ cat.nome }}
                        </option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-2 d-flex align-items-end">
                    <button type="submit" class="btn btn-primary w-100">
                        <i class="bi bi-funnel"></i> Filtrar
                    </button>
                </div>
            </form>
            {% if busca or categoria_selecionada %}
            <div class="mt-3">
                <a href="/anuncios" class="btn btn-outline-secondary btn-sm">
                    <i class="bi bi-x-circle"></i> Limpar filtros
                </a>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Resultados -->
    <div class="mb-3">
        <small class="text-muted">
            {% if total_anuncios > 0 %}
            Mostrando {{ anuncios|length }} de {{ total_anuncios }} anúncio(s)
            {% else %}
            Nenhum anúncio encontrado
            {% endif %}
        </small>
    </div>

    {% if anuncios %}
    <!-- Grid de Anúncios -->
    <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 g-4 mb-4">
        {% for anuncio in anuncios %}
        <div class="col">
            {% include "components/card_anuncio.html" %}
        </div>
        {% endfor %}
    </div>

    <!-- Paginação -->
    {% if total_paginas > 1 %}
    <nav aria-label="Navegação de páginas">
        <ul class="pagination justify-content-center">
            <!-- Anterior -->
            <li class="page-item {% if pagina_atual <= 1 %}disabled{% endif %}">
                <a class="page-link" href="/anuncios?pagina={{ pagina_atual - 1 }}{% if busca %}&busca={{ busca }}{% endif %}{% if categoria_selecionada %}&categoria={{ categoria_selecionada }}{% endif %}">
                    <i class="bi bi-chevron-left"></i> Anterior
                </a>
            </li>

            <!-- Números das páginas -->
            {% set inicio = [1, pagina_atual - 2]|max %}
            {% set fim = [total_paginas, pagina_atual + 2]|min %}

            {% if inicio > 1 %}
            <li class="page-item">
                <a class="page-link" href="/anuncios?pagina=1{% if busca %}&busca={{ busca }}{% endif %}{% if categoria_selecionada %}&categoria={{ categoria_selecionada }}{% endif %}">1</a>
            </li>
            {% if inicio > 2 %}
            <li class="page-item disabled"><span class="page-link">...</span></li>
            {% endif %}
            {% endif %}

            {% for p in range(inicio, fim + 1) %}
            <li class="page-item {% if p == pagina_atual %}active{% endif %}">
                <a class="page-link" href="/anuncios?pagina={{ p }}{% if busca %}&busca={{ busca }}{% endif %}{% if categoria_selecionada %}&categoria={{ categoria_selecionada }}{% endif %}">{{ p }}</a>
            </li>
            {% endfor %}

            {% if fim < total_paginas %}
            {% if fim < total_paginas - 1 %}
            <li class="page-item disabled"><span class="page-link">...</span></li>
            {% endif %}
            <li class="page-item">
                <a class="page-link" href="/anuncios?pagina={{ total_paginas }}{% if busca %}&busca={{ busca }}{% endif %}{% if categoria_selecionada %}&categoria={{ categoria_selecionada }}{% endif %}">{{ total_paginas }}</a>
            </li>
            {% endif %}

            <!-- Próximo -->
            <li class="page-item {% if pagina_atual >= total_paginas %}disabled{% endif %}">
                <a class="page-link" href="/anuncios?pagina={{ pagina_atual + 1 }}{% if busca %}&busca={{ busca }}{% endif %}{% if categoria_selecionada %}&categoria={{ categoria_selecionada }}{% endif %}">
                    Próximo <i class="bi bi-chevron-right"></i>
                </a>
            </li>
        </ul>
    </nav>
    {% endif %}

    {% else %}
    <!-- Estado Vazio -->
    <div class="card shadow-sm">
        <div class="card-body text-center py-5">
            <i class="bi bi-shop text-muted display-1"></i>
            <h4 class="mt-3">Nenhum anúncio encontrado</h4>
            <p class="text-muted">
                {% if busca or categoria_selecionada %}
                Tente ajustar os filtros de busca.
                {% else %}
                Ainda não há anúncios cadastrados.
                {% endif %}
            </p>
            {% if busca or categoria_selecionada %}
            <a href="/anuncios" class="btn btn-outline-primary">
                <i class="bi bi-arrow-counterclockwise"></i> Ver todos os anúncios
            </a>
            {% endif %}
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}
